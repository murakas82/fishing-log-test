<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fishing Log</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://www.googleapis.com">
</head>

<body class="page">
  <main class="page-inner">

    <!-- HEADER -->
    <header class="page-header">
      <div>
        <h1 class="page-title">My fishing spots</h1>
        <p class="page-subtitle">
          Track spots, catches, predictions and weather.
        </p>
      </div>

      <button id="logoutBtn" class="btn-outline">
        Log out
      </button>
    </header>

    <!-- USER INFO -->
    <section class="card">
      <h2 class="card-title">Logged in</h2>
      <p class="card-body" id="userEmail">Loading…</p>
    </section>

    <!-- ADD NEW SPOT BUTTON -->
    <section class="card">
      <button onclick="window.location.href='add-spot.html'" class="btn-primary">
        Add new spot
      </button>
    </section>

    <!-- FISHING SPOTS LIST -->
    <section class="card">
      <h2 class="card-title">Your fishing spots</h2>
      <div id="spotsList" class="list-vertical">
        <p class="muted-text">Loading spots…</p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer style="text-align:center; padding:20px 0; opacity:0.8;">
      <a href="privacy.html" style="color:#60a5fa; text-decoration:underline;">
        Privacy Policy
      </a>
    </footer>

  </main>

  <!-- FIREBASE + APP LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCXIdT74cNDSVIoMs3NZ86tPf2kzFm8Iug",
      authDomain: "fishing-log-app-murx.firebaseapp.com",
      projectId: "fishing-log-app-murx",
      storageBucket: "fishing-log-app-murx.appspot.com",
      messagingSenderId: "1056807867882",
      appId: "1:1056807867882:web:e59ddd8f6353d190080e93"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userEmailEl = document.getElementById("userEmail");
    const spotsListEl = document.getElementById("spotsList");
    const logoutBtn = document.getElementById("logoutBtn");

    logoutBtn.addEventListener("click", () => signOut(auth));

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      userEmailEl.textContent = user.email;

      const spotsRef = collection(db, "spots");
      const q = query(spotsRef, where("userId", "==", user.uid));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        spotsListEl.innerHTML = `<p class="muted-text">No fishing spots added yet.</p>`;
        return;
      }

      spotsListEl.innerHTML = "";

      snapshot.forEach(doc => {
        const spot = doc.data();

        const row = document.createElement("div");
        row.className = "list-row";

        const left = document.createElement("div");
        left.className = "list-row-main";
        left.textContent = spot.name;

        const right = document.createElement("div");
        right.className = "list-row-meta";

        const viewBtn = document.createElement("button");
        viewBtn.className = "btn-small";
        viewBtn.textContent = "Details";
        viewBtn.onclick = () => {
          window.location.href = `spot.html?id=${doc.id}`;
        };

        right.appendChild(viewBtn);
        row.appendChild(left);
        row.appendChild(right);

        spotsListEl.appendChild(row);
      });
    });
  </script>

  <!-- COOKIE BANNER -->
  <script src="cookie-consent.js"></script>
</body>
</html>
